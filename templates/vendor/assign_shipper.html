{%extends 'base.html'%}

{%load static %}

{%block content%}
<!-- Main Section Start -->
<div class="main-section">
    <div class="page-section nopadding cs-nomargin" style="margin-top: 0px;padding-top: 60px;padding-bottom: 10px;margin-bottom: 0px;">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="row">
                        <aside class="col-lg-2 col-md-2 col-sm-12 col-xs-12">
                            
                        </aside>
                        <div class="col-lg-7 col-md-7 col-sm-12 col-xs-12">
                            <div class="listing-sorting-holder">
                                <div class="row">
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                        <h4>Select a shipper for the Order: {{order_number}} </h4>

                                        <h6>{{shipper_count}} Shippers found</h6>
                                    </div>
                                </div>
                            </div>
                            <div class="listing simple">
                                <ul>
                                    {% for shipper in shippers %}
                                    <li style="line-height:15px;">
                                        <div class="img-holder">
                                            
                                            <figure>
                                                <a href="#">
                                                    {% if shipper.user_profile.profile_picture %}
                                                        <img src="{{shipper.user_profile.profile_picture.url}}" class="img-list wp-post-image" alt="">
                                                    {% else %}
                                                        <img src="{%static 'images/default-profile.png'%}" class="img-list wp-post-image" alt="">                                  
                                                    {%endif%}
                                                 </a>
                                                </figure>
                                            <span class="restaurant-status close"><em class="bookmarkRibbon"></em>Close</span>
                                        </div>
                                        <div class="text-holder">
                                           
                                            <div class="post-title">
                                                <h5>
                                                    {{shipper.shipper_name}}
                                                </h5>
                                            </div> 
                                            {% if shipper.user_profile.address %}
                                            <span><small class="text-muted">{{shipper.user_profile.address}}</small></span>
                                            {%endif%}
                                        </div>
                                        <div class="list-option">
                                            <a href="#" class="confirm_shipper viewmenu-btn text-color" onclick="return confirm('Press 'ok' to confirm to add this shipper.')" data-id="{{shipper.id}}" data-url="{% url 'confirm_shipper' shipper.id order_number%}" >Select</a>                                                  

                                        
                                        </div>
                                    </li>
                                    {%endfor%}


                                    
                                </ul>
                            </div>
                            
                        </div>
                       
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Main Section End -->
<script>
$('.confirm_shipper').on('click', function(e){
    e.preventDefault();
    //get csrf token in js
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    const csrftoken = getCookie('csrftoken');
    console.log('csrftoken ==> ', csrftoken);
  
    
    var url =  $(this).attr('data-url');


    $.ajax({
        type: 'POST',
        url: url,
        data: {
            'csrfmiddlewaretoken': csrftoken,

        },
        success: function(response){
            console.log('response==>', response);
            // From payments view, pass transaction_id and order_number in ajax response after payment success. Then get the transaction_id and order_number from the response and load them into url of the redirected/href page(order_complete). From the url render transaction_id and order_number into order_complete.html
            //this will be GET request
            //window.location.href = order_complete + '?order_no='+response.order_number+'&trans_id='+response.transaction_id
        }
    })   

})
</script> 

{%endblock%}